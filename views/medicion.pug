-var stringData = JSON.stringify(data.mediciones)
-var stringDataAyer = JSON.stringify(data.medicionesayer)
doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0')
    title
    script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js")
    link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=Lato|Open+Sans')
    script.
      data = JSON.parse("#{stringData}".replace(/&quot;/g,'"'));
      dataAyer = JSON.parse("#{stringDataAyer}".replace(/&quot;/g,'"'));
      $(document).ready( function() {
            var now = new Date();
            var month = (now.getMonth() + 1);               
            var day = now.getDate();
            if(month < 10) 
                month = "0" + month;
            if(day < 10) 
                day = "0" + day;
            var today = now.getFullYear() + "-" + month + "-" + day; 
            $('#FromDate').attr("value", today);
        });
      len = data.length;
      if (len > 48){
          total1 = 0;
          for(i = data.length-1; i >= data.length-32; i--){
            total1 += parseInt(data[i].State);
          }
          total1 = total1/32;
          total2 = 0;
          for(i = data.length-1; i >= data.length-48; i--){
            total2 += parseInt(data[i].State);
          }
          total2 = total2/48;
      }
      else if(len > 32){
          total1 = 0;
          for(i = data.length-1; i >= data.length-32; i--){
            total1 += parseInt(data[i].State);
          }
          total1 = total1/32;
          total2 = 0;
          for(i = len-1; i >= 0; i--){
            total2 += parseInt(data[i].State);
          }
          for(i=dataAyer.length-1; i >= dataAyer.length+(len-48); i--){
            total2 += parseInt(dataAyer[i].State);
          }
          total2 = total2/48;
      }
      else {
        total1 = 0;
          for(i = len-1; i >= 0; i--){
            total1 += parseInt(data[i].State);
          }
          for(i=dataAyer.length-1; i >= dataAyer.length+(len-32); i--){
            total1 += parseInt(dataAyer[i].State);
          }
          total1 = total1/32;
        total2 = 0;
          for(i = len-1; i >= 0; i--){
            total2 += parseInt(data[i].State);
          }
          for(i=dataAyer.length-1; i >= dataAyer.length+(len-48); i--){
            total2 += parseInt(dataAyer[i].State);
          }
          total2 = total2/48;
      }
      function buscarProm(opc){
        if(opc=='1'){
            $('#valor').val(total1);
          }
        else{
            $('#valor').val(total2);
          }
      }
  body        
    .container
      h1= data.estacion_id.toUpperCase()
      h2= data.sensor_id
      if(data.prom)
        #promedios
            label Promedios:
            select(onchange='buscarProm(this.options[this.selectedIndex].value)')
              option(value='1') Últimas 8 hs
              option(value='2') Últimas 12 hs
            input(type="text", disabled)#valor
      if (data.details)
        button.btn.btn-info(type='button', onclick='getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'/?date='+data.fecha+'");')#atras Atras
      else if (data.fecha)
        if (data.details)
        button.btn.btn-info(type='button', onclick='getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'");')#atras Atras
      else
        button.btn.btn-info(type='button', onclick='getData("sensores/'+data.estacion_id+'");')#atras Atras
      .row
        .form-group(style='margin-top: 50px; margin-left:-90px;')
          label.col-sm-2.control-label(for='inputPassword', style='padding-top: 10px; padding-left: 115px; top: -20px; vertical-align: middle;') SENSOR
          .col-sm-10(style='top: -82px;')
            select(onchange='getData("mediciones/"+this.options[this.selectedIndex].value+"/'+data.estacion_id+'");', style='margin-bottom:0px;').form-control
              for sensor in data.sensores
                if data.sensor_id == sensor.Id
                  option(value=sensor.Id, selected)= sensor.Id
                else
                  option(value=sensor.Id)= sensor.Id
          .col-md-12        
            #selector
                form(onsubmit='return getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'/?date="+this.elements["date"].value);')
                  #fecha
                    label(for='FromDate') Ingresa Fecha:
                    input(type='date', name='date')#FromDate
                  hr
                  input#btnSubmit.btn.btn-success(type='submit',value='Buscar')
          .col-md-12          
            table.table.table-bordered.table-inverse(style='margin-top:30px;')#tabla  
              thead 
                tr
                  th Timestamp
                  th Valor
                  th
              tbody
                for medicion in data.mediciones
                  tr
                    td
                      if(medicion.Day)
                        a(href="#", onclick='getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'/?date='+medicion.Day.substring(0,10)+'");')= medicion.Day
                      else
                        = medicion.At
                    td= medicion.State
                    td= medicion.DayStatisticLink
            if(medicion.Day)
              button#detalles(onclick='getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'/?date='+medicion.Day.substring(0,10)+'&details=true");').btn.btn-success Detalles
            else
              button#detalles(onclick='getData("mediciones/'+data.sensor_id+'/'+data.estacion_id+'/?date='+medicion.At.substring(0,10)+'&details=true");').btn.btn-success Detalles